<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- board_study mapper -->
<mapper namespace="dev.mvc.mapper.StudyMapper">

<!-- 스터디 등록 -->
 <insert id="createStudy">
insert into board_study (
title
, writer
, categoryD
, categoryS
, max
, rDId
, rSId
, age
, sc
, sd
, st
, et
, content
) values (
#{title}
, #{writer}
, #{categoryD}
, #{categoryS}
, #{max}
, #{rDId}
, #{rSId} <!-- null허용 -->
, #{age}
, #{sc}
, #{sd}
, #{st}
, #{et}
, #{content} <!-- null허용 -->
)
</insert>

<!-- 스터디 읽어오기 -->
<select id="readStudy" resultType="dev.mvc.domain.StudyVO">
SELECT
ba.bsbno
, bs.bno
, bs.title
, u.NICKNAME
, c.cDName
, c.cSName
, bs.now
, bs.max
, r.rDName
, r.rSName
, bs.age
, bs.sc
, bs.sd
, bs.st
, bs.et
, bs.content
, bs.vct
, bs.rct
, bs.regdate
, bs.enddate
FROM 
board_study bs
LEFT JOIN(board_attach ba)
ON bs.bno = ba.BSBNO
, region r
, study_category c
, user u
WHERE bs.rDId = r.RDID
AND bs.categoryD = c.CDID
AND bs.categoryS = c.CSID
AND bs.rSId = r.RSID
AND u.EMAIL = bs.writer
AND bs.bno = #{bno}
</select>

<!-- 전체불러오기 -->
<select id="studyList" resultType="dev.mvc.domain.StudyVO">
<![CDATA[
SELECT
ba.bsbno
, bs.bno
, bs.title
, u.NICKNAME
, c.cDName
, c.cSName
, bs.now
, bs.max
, r.rDName
, r.rSName
, bs.age
, bs.sc
, bs.sd
, bs.st
, bs.et
, bs.content
, bs.vct
, bs.rct
, bs.regdate
, bs.enddate
FROM 
board_study bs
LEFT JOIN(board_attach ba)
ON bs.bno = ba.BSBNO
, region r
, study_category c
, user u
WHERE bs.rDId = r.RDID
AND bs.categoryD = c.CDID
AND bs.categoryS = c.CSID
AND bs.rSId = r.RSID
AND u.EMAIL = bs.writer
AND bs.bno > 0
ORDER BY bs.bno desc, bs.regdate desc;
]]>
</select>

<!-- 파일 등록 -->
<select id="addFile">
INSERT
INTO
board_attach(
name
, bsBno

)
VALUES(
#{name}
, LAST_INSERT_ID()

)
</select>

<select id="getFile" resultType="String">
SELECT
name
FROM board_attach
WHERE bsbno = #{bno}
ORDER BY regdate;
</select>

</mapper>
